<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>대진 등록 | DOC-LINK</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;500;700&family=Noto+Sans+KR:wght@300;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/styles.css">
    <style>
        .register-container {
            min-height: 100vh;
            padding: 100px 8% 80px;
            max-width: 800px;
            margin: 0 auto;
        }

        .register-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
        }

        .register-header h1 {
            font-size: 2rem;
            font-weight: 700;
        }

        .register-card {
            background: var(--glass-bg);
            backdrop-filter: blur(30px);
            border: 1px solid var(--glass-border);
            border-radius: 30px;
            padding: 50px;
        }

        .time-input-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }

        .radio-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            background: rgba(255, 255, 255, 0.6);
            border: 2px solid var(--glass-border);
            border-radius: 12px;
            cursor: pointer;
            transition: 0.3s;
        }

        .radio-item:hover {
            background: var(--accent-soft);
        }

        .radio-item.active {
            border-color: var(--primary-btn);
            background: rgba(93, 93, 99, 0.1);
        }

        .radio-item input[type="radio"] {
            cursor: pointer;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.6);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            cursor: pointer;
            transition: 0.3s;
        }

        .checkbox-item:hover {
            background: var(--accent-soft);
        }

        .checkbox-item input[type="checkbox"] {
            cursor: pointer;
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 1px solid var(--glass-border);
        }

        .info-box {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
        }

        .info-box h4 {
            font-size: 0.95rem;
            font-weight: 600;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .info-box p {
            font-size: 0.85rem;
            color: var(--text-sub);
            line-height: 1.6;
        }

        .full-day-section {
            display: none;
        }

        .full-day-section.active {
            display: block;
        }

        @media (max-width: 768px) {
            .register-container {
                padding: 100px 4% 60px;
            }

            .register-card {
                padding: 40px 25px;
            }

            .radio-group {
                flex-direction: column;
            }

            .radio-item {
                width: 100%;
            }

            .time-input-group {
                grid-template-columns: 1fr !important;
            }

            .form-actions {
                flex-direction: column;
            }

            .form-actions button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="ambient-bg">
        <div class="blob blob-1"></div>
        <div class="blob blob-2"></div>
    </div>

    <nav>
        <a href="index.html" class="logo">DOC-LINK</a>
        <div class="nav-links">
            <a href="hospital-dashboard.html">대시보드</a>
            <a href="hospital-profile.html">프로필</a>
            <a href="#" onclick="logoutHandler()">로그아웃</a>
        </div>
    </nav>

    <div class="register-container">
        <div class="register-header">
            <h1>대진 등록</h1>
            <a href="hospital-dashboard.html" class="btn btn-secondary">돌아가기</a>
        </div>

        <div class="info-box">
            <h4><i class="fa-solid fa-info-circle"></i> 안내사항</h4>
            <p>대진 등록 시 자동 매칭 시스템이 근무 가능한 의사에게 알림을 발송합니다. 중복 근무 방지 기능이 작동하여 이미 다른 병원에 확정된 일정이 있는 의사는 매칭에서 제외됩니다.</p>
        </div>

        <form id="registerForm" class="register-card">
            <div class="form-group">
                <label>근무 유형</label>
                <div class="radio-group">
                    <div class="radio-item active" onclick="selectRadio(this, 'time')">
                        <input type="radio" name="workType" value="time" checked>
                        <span>시간제 근무</span>
                    </div>
                    <div class="radio-item" onclick="selectRadio(this, 'full')">
                        <input type="radio" name="workType" value="full">
                        <span>전일 근무</span>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label for="date">근무 날짜</label>
                <input type="date" id="date" name="date" required>
            </div>

            <div id="timeSection">
                <div class="form-group">
                    <label>근무 시간</label>
                    <div class="time-input-group">
                        <div class="form-group">
                            <label for="startTime">시작 시간</label>
                            <input type="time" id="startTime" name="startTime" step="1800" required>
                            <small style="color: var(--text-sub); font-size: 0.85rem; margin-top: 5px; display: block;">30분 단위로 선택 가능합니다.</small>
                        </div>
                        <div class="form-group">
                            <label for="endTime">종료 시간</label>
                            <input type="time" id="endTime" name="endTime" step="1800" required>
                            <small style="color: var(--text-sub); font-size: 0.85rem; margin-top: 5px; display: block;">30분 단위로 선택 가능합니다.</small>
                        </div>
                    </div>
                    <div style="margin-top: 15px; padding: 15px; background: rgba(255, 255, 255, 0.6); border-radius: 12px; border: 1px solid var(--glass-border);">
                        <p style="font-size: 0.85rem; color: var(--text-sub); margin-bottom: 8px;"><strong>선택한 시간:</strong></p>
                        <p id="selectedTimeRange" style="font-size: 0.9rem; font-weight: 600; color: var(--text-main);">시간을 선택해주세요</p>
                        <p id="selectedDuration" style="font-size: 0.8rem; color: var(--text-sub); margin-top: 5px;"></p>
                    </div>
                </div>
            </div>

            <div class="full-day-section" id="fullDaySection">
                <div class="form-group">
                    <label>전일 근무 시간</label>
                    <div class="radio-group">
                        <div class="radio-item active" onclick="selectRadio(this)">
                            <input type="radio" name="fullDayTime" value="09-17" checked>
                            <span>오전 9시 - 오후 5시</span>
                        </div>
                        <div class="radio-item" onclick="selectRadio(this)">
                            <input type="radio" name="fullDayTime" value="09-18">
                            <span>오전 9시 - 오후 6시</span>
                        </div>
                        <div class="radio-item" onclick="selectRadio(this)">
                            <input type="radio" name="fullDayTime" value="custom">
                            <span>직접 설정</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label for="specialty">진료 과목</label>
                <select id="specialty" name="specialty" required>
                    <option value="">선택하세요</option>
                    <option value="internal">내과</option>
                    <option value="surgery">외과</option>
                    <option value="orthopedic">정형외과</option>
                    <option value="pediatrics">소아과</option>
                    <option value="obstetrics">산부인과</option>
                    <option value="psychiatry">정신건강의학과</option>
                    <option value="dermatology">피부과</option>
                    <option value="ophthalmology">안과</option>
                    <option value="otolaryngology">이비인후과</option>
                    <option value="radiology">영상의학과</option>
                    <option value="emergency">응급의학과</option>
                    <option value="other">기타</option>
                </select>
            </div>

            <div class="form-group">
                <label>필수 자격 요건</label>
                <div class="checkbox-group">
                    <label class="checkbox-item">
                        <input type="checkbox" name="requirement" value="board">
                        <span>전문의 자격</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="requirement" value="experience">
                        <span>5년 이상 경력</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="requirement" value="license">
                        <span>면허 확인 완료</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="requirement" value="insurance">
                        <span>의료배상책임보험 가입</span>
                    </label>
                </div>
            </div>

            <div class="form-group">
                <label for="description">상세 설명</label>
                <textarea id="description" name="description" rows="4" placeholder="대진에 대한 상세 정보를 입력해주세요 (환자 수, 업무 내용 등)">- 예상 환자 수: 약 20-30명
- 진료 형태: 일반 외래
- 기타 사항: EMR 시스템 사용 가능</textarea>
            </div>

            <div class="form-group">
                <label for="deadline">모집 마감일</label>
                <input type="date" id="deadline" name="deadline" required>
                <small style="color: var(--text-sub); font-size: 0.85rem; margin-top: 5px; display: block;">이 날짜까지 의사 매칭을 받습니다.</small>
            </div>

            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="window.location.href='hospital-dashboard.html'">취소</button>
                <button type="submit" class="btn btn-main">등록하기</button>
            </div>
        </form>
    </div>

    <script>
        function selectRadio(element, workType) {
            const radioGroup = element.closest('.radio-group');
            radioGroup.querySelectorAll('.radio-item').forEach(item => {
                item.classList.remove('active');
                item.querySelector('input[type="radio"]').checked = false;
            });
            element.classList.add('active');
            element.querySelector('input[type="radio"]').checked = true;

            if (workType) {
                const timeSection = document.getElementById('timeSection');
                const fullDaySection = document.getElementById('fullDaySection');
                
                if (workType === 'time') {
                    timeSection.style.display = 'block';
                    fullDaySection.classList.remove('active');
                } else {
                    timeSection.style.display = 'none';
                    fullDaySection.classList.add('active');
                }
            }
        }

        // 오늘 날짜를 기본값으로 설정
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('date').value = today;
        document.getElementById('deadline').min = today;

        // 날짜 변경 시 마감일 최소값 업데이트
        document.getElementById('date').addEventListener('change', (e) => {
            document.getElementById('deadline').min = e.target.value;
        });

        // 시간 범위 계산 및 표시
        function updateTimeRange() {
            const startTime = document.getElementById('startTime').value;
            const endTime = document.getElementById('endTime').value;
            const rangeDisplay = document.getElementById('selectedTimeRange');
            const durationDisplay = document.getElementById('selectedDuration');

            if (startTime && endTime) {
                const [startHour, startMin] = startTime.split(':').map(Number);
                const [endHour, endMin] = endTime.split(':').map(Number);
                
                const startMinutes = startHour * 60 + startMin;
                const endMinutes = endHour * 60 + endMin;
                
                if (endMinutes > startMinutes) {
                    const durationMinutes = endMinutes - startMinutes;
                    const hours = Math.floor(durationMinutes / 60);
                    const minutes = durationMinutes % 60;
                    
                    let durationText = '';
                    if (hours > 0 && minutes > 0) {
                        durationText = `${hours}시간 ${minutes}분`;
                    } else if (hours > 0) {
                        durationText = `${hours}시간`;
                    } else {
                        durationText = `${minutes}분`;
                    }
                    
                    rangeDisplay.textContent = `${formatTime(startTime)} - ${formatTime(endTime)}`;
                    durationDisplay.textContent = `총 근무 시간: ${durationText}`;
                } else {
                    rangeDisplay.textContent = '종료 시간이 시작 시간보다 늦어야 합니다.';
                    durationDisplay.textContent = '';
                }
            } else {
                rangeDisplay.textContent = '시간을 선택해주세요';
                durationDisplay.textContent = '';
            }
        }

        function formatTime(timeStr) {
            if (!timeStr) return '';
            const [hour, minute] = timeStr.split(':');
            const hourNum = parseInt(hour);
            const period = hourNum >= 12 ? '오후' : '오전';
            const displayHour = hourNum > 12 ? hourNum - 12 : (hourNum === 0 ? 12 : hourNum);
            return `${period} ${displayHour}:${minute}`;
        }

        document.getElementById('startTime').addEventListener('change', updateTimeRange);
        document.getElementById('endTime').addEventListener('change', updateTimeRange);

        document.getElementById('registerForm').addEventListener('submit', (e) => {
            e.preventDefault();
            alert('대진이 등록되었습니다. 자동 매칭 시스템이 작동합니다.');
            window.location.href = 'hospital-dashboard.html';
        });
    </script>

    <script src="js/auth.js"></script>
    <script>
        // 인증 확인
        window.addEventListener('DOMContentLoaded', () => {
            checkAuth('hospital');
        });

        function logoutHandler() {
            if (confirm('로그아웃하시겠습니까?')) {
                logout();
            }
        }
    </script>
</body>
</html>